import Head from 'next/head';
import { MongoClient } from 'mongodb';

export default function Home(props) {
  console.log(props);
  return (
    <>
      <Head>
        <title>MyCoolStore</title>
        <meta name='description' content='Generated by create next app' />
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <link rel='icon' href='/favicon.ico' />
      </Head>
    </>
  );
}

export async function getStaticProps() {
  // fetch data from an API
  const client = await MongoClient.connect(
    'mongodb+srv://m001-student:m001-mongodb-basics@cluster0.6hgde.mongodb.net/myFirstDatabase?retryWrites=true&w=majority'
  );
  const db = client.db();

  const categoriesCollection = db.collection('categories');
  const productsCollection = db.collection('products');

  const categories = await categoriesCollection.find().toArray();
  const products = await productsCollection.find().toArray();

  client.close();

  return {
    props: {
      categories: categories.map((category) => ({
        id: category._id.toString(),
        name: category.name,
      })),
      products: products.map((product) => ({
        id: product._id.toString(),
        title: product.title,
      })),
    },
    revalidate: 1,
  };
}
